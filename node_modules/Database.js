const mysql = require("mysql")
class Database {

	constructor(host = "localhost", user = "root", database = "stock"){
		this.dbConfig = {
			host: host,
			user: user,
			database: database
		};
		this.connection = mysql.createConnection(this.dbConfig);
	}
	handleDisconnect(e) {
		if(e.code === "PROTOCOL_CONNECTION_LOST") {
			this.connection = mysql.createConnection(this.dbConfig);
		}
		else
			throw e;
	}
	query(sql, args){
		return new Promise((resolve, reject) => {
			try {
				this.connection.query(sql, args, (err, rows)=> {
					if(err) {
						console.log(err);
						this.connection = mysql.createConnection(this.dbConfig);
						console.log("hi")
						//return reject(err);
					};
					resolve(rows);
				});
			} catch(e) {
				console.log("caught", e);
			}
		}).catch((e) => {
			this.handleDisconnect(e);
		});
	}

	close(){
		return new Promise((resolve, reject) => {
			this.connection.end( err => {
				if(err) return reject(err)
				resolve();
			});
		});
	}
}
module.exports = Database